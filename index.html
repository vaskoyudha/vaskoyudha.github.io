<!doctype html>
<html lang="id" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SitSense — Dashboard</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

    <!-- Tailwind + DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Icons, Animations, Charts -->
    <script src="https://unpkg.com/lucide@latest" defer></script>
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />
    <script src="https://unpkg.com/aos@2.3.4/dist/aos.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>

    <!-- Notifications & Progress (optional, used later) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress/nprogress.css" />
    <script src="https://cdn.jsdelivr.net/npm/nprogress/nprogress.js" defer></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/toastify-js" defer></script>

    <!-- Firebase (compat for simplicity / already used in your project) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js" defer></script>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <link rel="stylesheet" href="./assets/css/styles.css" />
    <link rel="stylesheet" href="./assets/css/theme.css" />

        <!-- Firebase (compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

    

  </head>
<audio id="alertSoft" src="./assets/audio/alert-soft.wav" preload="auto"></audio>
<audio id="alertHard" src="./assets/audio/alert-hard.wav" preload="auto"></audio>
<audio id="assistantChime" src="./assets/audio/assistant-chime.wav" preload="auto"></audio>

  <body class="min-h-screen text-slate-100">
    <!-- ================= WELCOME SPLASH ================= -->
    <div x-data="{ show: true }" x-init="setTimeout(()=>show=false, 2200)" x-show="show"
         x-transition.opacity.duration.500ms
         class="fixed inset-0 z-[100] flex items-center justify-center bg-[#0b1220]">
      <div class="relative w-[min(680px,92vw)] rounded-3xl p-8 md:p-10 text-center shadow-2xl overflow-hidden glassy-card" data-aos="zoom-in">
        <div class="pointer-events-none absolute -top-24 -left-24 w-72 h-72 rounded-full bg-cyan-500/20 blur-3xl"></div>
        <div class="pointer-events-none absolute -bottom-28 -right-16 w-80 h-80 rounded-full bg-emerald-400/20 blur-3xl"></div>

        <!-- Logo placement -->
        <img src="./assets/img/logo-sitsense.svg" alt="SitSense Logo" class="mx-auto h-16 md:h-20 w-auto mb-5" />

        <h1 class="text-2xl md:text-3xl font-semibold tracking-tight">Selamat Datang di <span class="text-cyan-400">SitSense</span></h1>
        <p class="mt-3 text-slate-300/90">Pemantau postur duduk cerdas. Lebih nyaman, sehat, dan produktif.</p>

        <div class="mt-6 flex items-center justify-center gap-2 text-sm text-slate-300/80">
          <span class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1">
            <i data-lucide="wifi" class="h-4 w-4"></i>
            Wi‑Fi: menyiapkan…
          </span>
          <span class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1">
            <i data-lucide="badge-check" class="h-4 w-4"></i>
            Auth: inisialisasi…
          </span>
        </div>

        <div class="mt-7">
          <button @click="show=false" class="btn btn-primary normal-case px-6">Masuk Dashboard</button>
        </div>
        <div class="mt-6 text-xs text-slate-400">© <span class="font-medium text-slate-300">SitSense</span> — Project IoT</div>
      </div>
    </div>

    <!-- ================= HEADER ================= -->
     <div id="header-slot"></div>
<script>
  (async () => {
    const slot = document.getElementById('header-slot');
    slot.innerHTML = await (await fetch('./components/header.html')).text();
    // tandai item aktif
    const file = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
    document.querySelectorAll('a[data-nav]').forEach(a => {
      const k = a.getAttribute('data-nav');
      const active = (k==='dashboard' && file==='index.html');
      if (active) a.classList.add('border','border-cyan-400/40','text-cyan-300');
    });
    if (window.lucide) window.lucide.createIcons();
  })();
</script>
    <header class="sticky top-0 z-40 border-b border-white/10 bg-[#0b1220]/80 backdrop-blur-xl">
      <div class="max-w-7xl mx-auto px-4 md:px-6 py-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <img src="./assets/img/logo-sitsense.svg" alt="SitSense" class="h-7 w-auto" />
          <span class="text-lg font-semibold tracking-tight">SitSense Dashboard</span>
        </div>
        <div class="flex items-center gap-2 text-xs md:text-sm">
          <span id="wifiStatus" class="inline-flex items-center gap-1 rounded-full bg-white/5 border border-white/10 px-3 py-1">
            <i data-lucide="wifi" class="h-4 w-4"></i>
            <span>Wi‑Fi: —</span>
          </span>
          <span id="authStatus" class="inline-flex items-center gap-1 rounded-full bg-white/5 border border-white/10 px-3 py-1">
            <i data-lucide="user-check" class="h-4 w-4"></i>
            <span>Auth: —</span>
          </span>
          <span class="inline-flex items-center gap-1 rounded-full bg-white/5 border border-white/10 px-3 py-1">
            <i data-lucide="clock" class="h-4 w-4"></i>
            <time id="clock">--:--:--</time>
          </span>
        </div>
      </div>
    </header>
    <script>
  // === 1) Konfigurasi Firebase ===
  const firebaseConfig = {
    apiKey: "AIzaSyCHpITmPUoKIb2niuh0G4vhJJJ0vBM2ijE",
    authDomain: "esp32kursi-pintar.firebaseapp.com",
    databaseURL: "https://esp32kursi-pintar-default-rtdb.firebaseio.com",
    projectId: "esp32kursi-pintar",
    storageBucket: "esp32kursi-pintar.appspot.com",
    messagingSenderId: "265798521874",
    appId: "1:265798521874:web:6097e5ae6ccf8ad683b4cb",
  };

  // === 2) Init app, auth anon, dan database ===
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db   = firebase.database();

  // (Opsional) sesuaikan kalau kamu punya banyak kursi/device
  const DEVICE_ID = "esp32_kursi_1";        // ganti sesuai punyamu
  const BASE_PATH = `devices/${DEVICE_ID}`; // RTDB path utama untuk device

  // === 3) Referensi elemen UI (pastikan id ini ada di HTML-mu) ===
  const wifiStatusEl = document.getElementById('wifiStatus');
  const authStatusEl = document.getElementById('authStatus'); // buatkan di header kalau belum ada

  function setBadge(el, text) { if (el) el.textContent = text; }

  // === 4) Sign-in Anonymous (aktifkan di Firebase Console > Authentication) ===
  auth.signInAnonymously()
    .then(() => setBadge(authStatusEl, 'Auth: OK'))
    .catch(err => setBadge(authStatusEl, 'Auth: Error'));

  // === 5) Subscribe data realtime dari RTDB ===
  // Contoh struktur data yang dibaca:
  // devices/{DEVICE_ID}/wifi  -> { ssid, rssi, connected }
  // devices/{DEVICE_ID}/telemetry -> { pressure, posture, ts }

  db.ref(`${BASE_PATH}/wifi`).on('value', (snap) => {
    const wifi = snap.val();
    if (!wifi) { setBadge(wifiStatusEl, 'WiFi: —'); return; }
    const label = wifi.connected ? `WiFi: ${wifi.ssid} (${wifi.rssi} dBm)` : 'WiFi: disconnected';
    setBadge(wifiStatusEl, label);
  });

  // Contoh: kirim data dummy (untuk uji tampilan)
  // HAPUS di production bila tidak perlu.
  window.__sendDummy = async () => {
    const now = Date.now();
    await db.ref(`${BASE_PATH}`).update({
      wifi: { ssid: "MyWiFi", rssi: -58, connected: true },
      telemetry: { pressure: 0.37, posture: "upright", ts: now }
    });
    alert('Dummy data terkirim.');
  };
</script>


    <!-- ================= MAIN ================= -->
    <main class="max-w-7xl mx-auto px-4 md:px-6 py-6 space-y-6">
      <!-- Quick status cards -->
      <section class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="card glassy-card card-border" data-aos="fade-up">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h3 class="card-title text-base">Durasi Duduk</h3>
              <i data-lucide="timer" class="h-5 w-5 text-cyan-300"></i>
            </div>
            <div class="mt-2 text-3xl font-bold"><span id="sitDuration">00:00:00</span></div>
            <p class="text-xs text-slate-300/80">Ambang lembut: <span id="softThresholdLabel">30m</span> • ambang kuat: <span id="hardThresholdLabel">60m</span></p>
          </div>
        </div>
        <div class="card glassy-card card-border" data-aos="fade-up" data-aos-delay="50">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h3 class="card-title text-base">Skor Postur</h3>
              <i data-lucide="activity" class="h-5 w-5 text-emerald-300"></i>
            </div>
            <div class="mt-2 flex items-end gap-2">
              <div class="text-3xl font-bold" id="postureScore">—</div>
              <div class="text-sm text-slate-300/80" id="postureLabel">menunggu data…</div>
            </div>
            <div class="mt-3">
              <progress class="progress progress-info w-full" value="0" max="100" id="postureScoreBar"></progress>
            </div>
          </div>
        </div>
        <div class="card glassy-card card-border" data-aos="fade-up" data-aos-delay="100">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h3 class="card-title text-base">Status Perangkat</h3>
              <i data-lucide="cpu" class="h-5 w-5 text-violet-300"></i>
            </div>
            <ul class="mt-2 text-sm space-y-1">
              <li>ESP32: <span id="deviceStatus" class="text-slate-200">—</span></li>
              <li>IP: <span id="deviceIP" class="text-slate-200">—</span></li>
              <li>Firmware: <span id="deviceFW" class="text-slate-200">—</span></li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Panel Parameter (Shape / Heatmap / Balance) -->
      <section class="grid grid-cols-1 xl:grid-cols-3 gap-4">
        <!-- Visual shape & heatmap -->
        <div class="xl:col-span-2 card glassy-card card-border" data-aos="fade-up">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h3 class="card-title">Parameter Visual</h3>
              <div class="badge badge-info badge-outline">Real-time</div>
            </div>

            <div class="relative mt-4 w-full aspect-[16/9] rounded-2xl overflow-hidden bg-slate-900/60 border border-white/5">
              <!-- Heatmap Canvas -->
              <canvas id="heatmapCanvas" class="absolute inset-0 w-full h-full"></canvas>
              <!-- Silhouette Overlay -->
              <img id="silhouette" src="./assets/img/posture-silhouette.svg" alt="silhouette" class="absolute inset-0 w-full h-full object-contain opacity-80" />
            </div>

            <!-- Balance indicators -->
            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <div class="flex items-center justify-between text-xs mb-1"><span>Keseimbangan Kiri ↔ Kanan</span><span id="balanceLRVal">0%</span></div>
                <div class="h-2 rounded-full bg-white/10 overflow-hidden">
                  <div id="balanceLRFill" class="h-full bg-cyan-400" style="width: 50%"></div>
                </div>
              </div>
              <div>
                <div class="flex items-center justify-between text-xs mb-1"><span>Keseimbangan Depan ↔ Belakang</span><span id="balanceFBVal">0%</span></div>
                <div class="h-2 rounded-full bg-white/10 overflow-hidden">
                  <div id="balanceFBFill" class="h-full bg-emerald-400" style="width: 50%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="panel-parameters-slot"></div>
        <script>
        (async () => {
            const slot = document.getElementById('panel-parameters-slot');
            const res = await fetch('/components/panel-parameters.html');
            slot.innerHTML = await res.text();
            if (window.lucide) lucide.createIcons(); // render ikon setelah inject
        })();
        </script>
        


        <!-- AI Advice panel -->
        <div class="card glassy-card card-border" data-aos="fade-up" data-aos-delay="60">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h3 class="card-title">Rekomendasi AI</h3>
              <div class="tooltip" data-tip="Didukung Gemini + Google Voice">
                <i data-lucide="sparkles" class="h-5 w-5 text-yellow-300"></i>
              </div>
            </div>
            <div id="adviceText" class="mt-2 text-slate-300/90 text-sm leading-relaxed">
              Menunggu data… rekomendasi personal akan muncul di sini.
            </div>
            <div class="mt-4 flex gap-2">
              <button id="btnRefreshAdvice" class="btn btn-outline btn-sm">Minta Rekomendasi</button>
              <button id="btnListenAdvice" class="btn btn-primary btn-sm">Dengarkan</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Charts -->
      <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <div class="card glassy-card card-border" data-aos="fade-up">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h3 class="card-title">Tekanan vs Waktu</h3>
              <i data-lucide="line-chart" class="h-5 w-5 text-cyan-300"></i>
            </div>
            <div class="mt-4">
              <canvas id="chartPressure" height="140"></canvas>
            </div>
          </div>
        </div>
        <div class="card glassy-card card-border" data-aos="fade-up" data-aos-delay="50">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h3 class="card-title">Kualitas Postur (Baik vs Koreksi)</h3>
              <i data-lucide="pie-chart" class="h-5 w-5 text-emerald-300"></i>
            </div>
            <div class="mt-4">
              <canvas id="chartQuality" height="140"></canvas>
            </div>
          </div>
        </div>
      </section>

      <div id="footer-slot"></div>
<script>
  (async () => {
    const slot = document.getElementById('footer-slot');
    const html = await (await fetch('/components/footer.html')).text();
    slot.innerHTML = html;
    if (window.lucide) window.lucide.createIcons();
    const y = document.getElementById('footerYear'); if (y) y.textContent = new Date().getFullYear();
  })();
</script>

<div id="modal-slot"></div>
<script>
  (async ()=> {
    document.getElementById('modal-slot').innerHTML =
      await (await fetch('/components/modal-detail.html')).text();
    if (window.lucide) window.lucide.createIcons();
  })();
</script>


    </main>

    <!-- ================= FOOTER ================= -->
    <footer class="border-t border-white/10 py-6">
      <div class="max-w-7xl mx-auto px-4 md:px-6 text-sm text-slate-400 flex items-center justify-between">
        <p>© <span class="text-slate-200 font-medium">SitSense</span> — Project IoT</p>
        <p>Versi UI: <span id="uiVersion">1.0.0</span></p>
      </div>
    </footer>

    <!-- ================= AUDIO (alerts & assistant) ================= -->
    <audio id="alertSoft" src="./assets/audio/alert-short.mp3" preload="auto"></audio>
    <audio id="alertHard" src="./assets/audio/alert-long.mp3" preload="auto"></audio>
    <audio id="assistantChime" src="./assets/audio/assistant-chime.mp3" preload="auto"></audio>

    <!-- ================= SCRIPTS (light inline boot only) ================= -->
    <script>
      // Init AOS & Lucide after page ready
      document.addEventListener('DOMContentLoaded', () => {
        if (window.AOS) AOS.init();
        if (window.lucide) window.lucide.createIcons();
      });

      // Simple live clock
      (function clock(){
        const el = document.getElementById('clock');
        if (!el) return; 
        const pad = n => String(n).padStart(2,'0');
        setInterval(()=>{
          const d = new Date();
          el.textContent = `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
        }, 1000);
      })();
    </script>

    <!-- ================= PLACEHOLDER for future modules ================= -->
    <!-- Uncomment these once files exist to avoid 404s during early setup -->
    <script src="./assets/js/firebase-config.js"></script>
    <script src="./assets/js/welcome.js"></script>
    <script src="./assets/js/ui.js"></script> 
    <script src="./assets/js/charts.js"></script> 
    <script src="./assets/js/posture-visual.js"></script> 
    <script src="./assets/js/alerts.js"></script>
    <script src="./assets/js/ai-gemini.js"></script>
    <script src="./assets/js/firebase-config.js"></script>
    <script src="./assets/js/app.js"></script>
    <script src="./assets/js/modal-detail.js"></script>

<script>
  // Opsi 1 (proxy): window.__GEMINI_PROXY_URL = 'https://your-proxy.example.com/gemini';
  // Opsi 2 (direct): SitSenseAI.setConfig({ apiKey: 'YOUR_GEMINI_API_KEY' });

  // Minta saran:
  (async () => {
    const advice = await getPostureAdvice({
      score: window.__postureScore || 62,
      imbalance: window.__imbalance || { lr: 0.15, fb: 0.08 },
      durationSec: (window.SitSenseAlerts?.getElapsedSeconds?.() || 0),
      lastAlerts: 'soft'
    });
    // tampilkan di UI
    if (window.showAdviceText) showAdviceText(advice.text);
  })();
</script>

    <!-- <script src="./assets/js/tts-google.js"></script> -->
    <!-- <script src="./assets/js/app.js"></script> -->
     
  </body>
</html>
