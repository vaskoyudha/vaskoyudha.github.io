<!doctype html>
<html lang="id" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SitSense — Riwayat</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

    <!-- Tailwind + DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Icons, Animations, Charts -->
    <script src="https://unpkg.com/lucide@latest" defer></script>
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />
    <script src="https://unpkg.com/aos@2.3.4/dist/aos.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>

    <!-- Notifications & Progress (optional) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress/nprogress.css" />
    <script src="https://cdn.jsdelivr.net/npm/nprogress/nprogress.js" defer></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/toastify-js" defer></script>

    <!-- Firebase (compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js" defer></script>

    <!-- App styles -->
    <link rel="stylesheet" href="./assets/css/styles.css" />
    <link rel="stylesheet" href="./assets/css/theme.css" />

    <style>
      body { font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif; }
    </style>
  </head>

  <body class="min-h-screen text-slate-100">
    <!-- ================= HEADER ================= -->
    <div id="header-slot"></div>
<script>
  (async () => {
    const slot = document.getElementById('header-slot');
    slot.innerHTML = await (await fetch('./components/header.html')).text();
    const file = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
    document.querySelectorAll('a[data-nav]').forEach(a => {
      const k = a.getAttribute('data-nav');
      const active =
        (k==='dashboard' && file==='index.html') ||
        (k==='history'   && file==='history.html') ||
        (k==='settings'  && file==='settings.html');
      if (active) a.classList.add('border','border-cyan-400/40','text-cyan-300');
    });
    if (window.lucide) window.lucide.createIcons();
  })();
</script>
    </header>

    <!-- ================= MAIN ================= -->
    <main class="max-w-7xl mx-auto px-4 md:px-6 py-6 space-y-6">
      <!-- Filters -->
      <section class="card glassy-card card-border" data-aos="fade-up">
        <div class="card-body">
          <div class="flex items-center justify-between">
            <h2 class="card-title">Filter Riwayat</h2>
            <div class="text-xs text-slate-400">Zona waktu browser</div>
          </div>

          <div class="mt-4 grid grid-cols-1 md:grid-cols-5 gap-3">
            <label class="form-control w-full">
              <div class="label"><span class="label-text">Dari Tanggal</span></div>
              <input id="fromDate" type="date" class="input input-bordered w-full" />
            </label>
            <label class="form-control w-full">
              <div class="label"><span class="label-text">Sampai Tanggal</span></div>
              <input id="toDate" type="date" class="input input-bordered w-full" />
            </label>
            <label class="form-control w-full">
              <div class="label"><span class="label-text">Agregasi</span></div>
              <select id="agg" class="select select-bordered w-full">
                <option value="hour">Per Jam</option>
                <option value="day" selected>Per Hari</option>
                <option value="week">Per Minggu</option>
              </select>
            </label>
            <label class="form-control w-full">
              <div class="label"><span class="label-text">Rentang Cepat</span></div>
              <div class="join w-full">
                <button id="quickToday"   class="btn btn-outline join-item">Hari ini</button>
                <button id="quick7"       class="btn btn-outline join-item">7H</button>
                <button id="quick30"      class="btn btn-outline join-item">30H</button>
              </div>
            </label>
            <div class="flex flex-col gap-2 pt-6 md:pt-8">
              <button id="btnFetchHistory" class="btn btn-primary">Terapkan</button>
              <div class="flex gap-2">
                <button id="btnExportCSV" class="btn btn-outline btn-sm">Export CSV</button>
                <button id="btnPrint" class="btn btn-outline btn-sm">Cetak</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- KPI cards -->
      <section class="grid grid-cols-1 md:grid-cols-5 gap-4">
        <div class="card glassy-card card-border" data-aos="fade-up"><div class="card-body">
          <div class="flex items-center justify-between"><span>Total Durasi</span><i data-lucide="timer" class="h-5 w-5 text-cyan-300"></i></div>
          <div class="text-2xl font-semibold mt-1" id="kpiTotalDuration">00:00:00</div>
        </div></div>
        <div class="card glassy-card card-border" data-aos="fade-up" data-aos-delay="40"><div class="card-body">
          <div class="flex items-center justify-between"><span>Jumlah Sesi</span><i data-lucide="list-checks" class="h-5 w-5 text-emerald-300"></i></div>
          <div class="text-2xl font-semibold mt-1" id="kpiSessions">0</div>
        </div></div>
        <div class="card glassy-card card-border" data-aos="fade-up" data-aos-delay="80"><div class="card-body">
          <div class="flex items-center justify-between"><span>Rata Durasi/Sesi</span><i data-lucide="hourglass" class="h-5 w-5 text-yellow-300"></i></div>
          <div class="text-2xl font-semibold mt-1" id="kpiAvgSession">00:00:00</div>
        </div></div>
        <div class="card glassy-card card-border" data-aos="fade-up" data-aos-delay="120"><div class="card-body">
          <div class="flex items-center justify-between"><span>% Postur Baik</span><i data-lucide="smile" class="h-5 w-5 text-emerald-300"></i></div>
          <div class="text-2xl font-semibold mt-1" id="kpiGoodPct">0%</div>
        </div></div>
        <div class="card glassy-card card-border" data-aos="fade-up" data-aos-delay="160"><div class="card-body">
          <div class="flex items-center justify-between"><span>Peringatan</span><i data-lucide="bell" class="h-5 w-5 text-rose-400"></i></div>
          <div class="text-2xl font-semibold mt-1" id="kpiAlerts">0</div>
        </div></div>
      </section>

      <!-- Charts: history -->
      <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <div class="card glassy-card card-border" data-aos="fade-up">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h3 class="card-title">Tekanan Rata-rata (sepanjang waktu)</h3>
              <i data-lucide="line-chart" class="h-5 w-5 text-cyan-300"></i>
            </div>
            <div class="mt-4 h-[280px]">
              <canvas id="historyPressure"></canvas>
            </div>
          </div>
        </div>
        <div class="card glassy-card card-border" data-aos="fade-up" data-aos-delay="60">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h3 class="card-title">Komposisi Kualitas Postur</h3>
              <i data-lucide="pie-chart" class="h-5 w-5 text-emerald-300"></i>
            </div>
            <div class="mt-4 h-[280px]">
              <canvas id="historyQuality"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- Sessions table -->
      <section class="card glassy-card card-border" data-aos="fade-up">
        <div class="card-body">
          <div class="flex items-center justify-between">
            <h3 class="card-title">Daftar Sesi Duduk</h3>
            <div class="text-xs text-slate-400">Klik baris untuk detail</div>
          </div>

          <div class="overflow-x-auto mt-4">
            <table class="table table-zebra">
              <thead>
                <tr>
                  <th>Tanggal</th>
                  <th>Mulai</th>
                  <th>Selesai</th>
                  <th>Durasi</th>
                  <th>Skor Rata</th>
                  <th>Baik</th>
                  <th>Buruk</th>
                  <th>Peringatan</th>
                  <th>Catatan</th>
                </tr>
              </thead>
              <tbody id="historyTableBody">
                <tr>
                  <td colspan="9">
                    <div class="skeleton skeleton-line w-full h-8"></div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination / actions -->
          <div class="mt-4 flex items-center justify-between text-sm">
            <div class="text-slate-400" id="historySummary">Menampilkan 0 sesi</div>
            <div class="join">
              <button class="btn btn-outline btn-sm join-item" id="prevPage">Sebelumnya</button>
              <button class="btn btn-outline btn-sm join-item" id="nextPage">Berikutnya</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- ================= FOOTER ================= -->
    <footer class="border-t border-white/10 py-6">
      <div class="max-w-7xl mx-auto px-4 md:px-6 text-sm text-slate-400 flex items-center justify-between">
        <p>© <span class="text-slate-200 font-medium">SitSense</span> — Project IoT</p>
        <p>Riwayat</p>
      </div>
    </footer>

    <!-- ================= Scripts ================= -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        if (window.AOS) AOS.init();
        if (window.lucide) window.lucide.createIcons();
        // Default rentang: 7 hari terakhir
        const today = new Date();
        const to = today.toISOString().slice(0,10);
        const from = new Date(Date.now() - 6*24*3600*1000).toISOString().slice(0,10);
        const fd = document.getElementById('fromDate');
        const td = document.getElementById('toDate');
        if (fd && !fd.value) fd.value = from;
        if (td && !td.value) td.value = to;

        // Quick range buttons (UI only; logic di history.js)
        document.getElementById('quickToday')?.addEventListener('click', ()=>{
          const t = new Date();
          const d = t.toISOString().slice(0,10);
          fd.value = d; td.value = d;
        });
        document.getElementById('quick7')?.addEventListener('click', ()=>{
          const t = new Date();
          td.value = t.toISOString().slice(0,10);
          fd.value = new Date(Date.now()-6*24*3600*1000).toISOString().slice(0,10);
        });
        document.getElementById('quick30')?.addEventListener('click', ()=>{
          const t = new Date();
          td.value = t.toISOString().slice(0,10);
          fd.value = new Date(Date.now()-29*24*3600*1000).toISOString().slice(0,10);
        });

        // Cetak
        document.getElementById('btnPrint')?.addEventListener('click', ()=> window.print());
      });
    </script>

    <!-- Module hooks (aktifkan saat file tersedia) -->
    <script src="./assets/js/firebase-config.js"></script>
    <script src="./assets/js/ui.js"></script>
    <script src="./assets/js/charts.js"></script>
    <script src="./assets/js/history.js"></script>
  </body>
</html>