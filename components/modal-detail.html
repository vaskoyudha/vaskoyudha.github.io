<!-- components/modal-detail.html -->
<!--
  Modal detail reusable untuk menampilkan informasi lengkap satu sensor/perangkat.
  Gunakan <dialog> (DaisyUI kompatibel). Buka/tutup via JS:

    const dlg = document.getElementById('sensorDetailModal');
    dlg.showModal(); // buka
    dlg.close();     // tutup

  Pengisian konten via data-role:
    [data-role=title]      — judul sensor (mis. "Tekanan Duduk")
    [data-role=id]         — id unik (mis. seat-1)
    [data-role=statusText] — teks status (Baik/Perlu Koreksi/Buruk/Offline)
    [data-role=score]      — angka skor
    [data-role=scoreLabel] — label skor (Baik/Perlu Koreksi/Buruk)
    [data-role=scoreBar]   — <progress> 0..100
    [data-role=balanceLRFill] + [data-role=balanceLRVal]
    [data-role=balanceFBFill] + [data-role=balanceFBVal]
    [data-role=avgPressure], [data-role=duration], [data-role=alerts], [data-role=updated], [data-role=resolution]
    [data-role=notes]      — catatan bebas
    #heatmapPreview        — <canvas> untuk snapshot heatmap

  Tindakan (button [data-action]):
    exportPNG | exportJSON | calibrate | close

  Tips include dinamis:
    <div id="modal-slot"></div>
    <script>
      (async ()=>{
        const slot = document.getElementById('modal-slot');
        slot.innerHTML = await (await fetch('/components/modal-detail.html')).text();
        if (window.lucide) window.lucide.createIcons();
      })();
    </script>
-->

<dialog id="sensorDetailModal" class="modal">
  <div class="modal-box w-11/12 max-w-5xl p-0 overflow-hidden">
    <!-- Header -->
    <div class="px-5 py-4 border-b border-white/10 flex items-center justify-between bg-[#0b1220]/80 backdrop-blur-xl">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-xl bg-white/5 border border-white/10 grid place-items-center">
          <i data-lucide="activity" class="h-4 w-4 text-cyan-300"></i>
        </div>
        <div class="leading-tight">
          <div class="text-xs text-slate-400">Detail Sensor</div>
          <div class="text-lg font-semibold" data-role="title">Tekanan Duduk</div>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium border status-badge">
          <span class="h-2 w-2 rounded-full status-dot"></span>
          <span data-role="statusText">Baik</span>
        </span>
        <form method="dialog">
          <button class="btn btn-ghost btn-sm btn-circle" data-action="close" aria-label="Tutup">
            <i data-lucide="x"></i>
          </button>
        </form>
      </div>
    </div>

    <!-- Body -->
    <div class="p-5 grid grid-cols-1 lg:grid-cols-12 gap-5">
      <!-- Left: metrics -->
      <section class="lg:col-span-5 space-y-4">
        <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
          <div class="flex items-end gap-2">
            <div class="text-3xl font-bold leading-none" data-role="score">—</div>
            <div class="mb-1 text-sm text-slate-300/80">/100</div>
            <div class="ml-auto text-xs px-2 py-0.5 rounded-full border border-white/10 bg-white/5" data-role="scoreLabel">—</div>
          </div>
          <progress class="progress w-full mt-3" value="0" max="100" data-role="scoreBar"></progress>
        </div>

        <div class="rounded-2xl border border-white/10 bg-white/5 p-4 space-y-3">
          <div class="text-sm font-medium">Keseimbangan</div>
          <div>
            <div class="flex items-center justify-between text-xs mb-1"><span>Kiri ↔ Kanan</span><span data-role="balanceLRVal">50%</span></div>
            <div class="h-2 rounded-full bg-white/10 overflow-hidden">
              <div class="h-full rounded-full bg-gradient-to-r from-cyan-400/70 to-emerald-400/70" style="width:50%" data-role="balanceLRFill"></div>
            </div>
          </div>
          <div>
            <div class="flex items-center justify-between text-xs mb-1"><span>Depan ↔ Belakang</span><span data-role="balanceFBVal">50%</span></div>
            <div class="h-2 rounded-full bg-white/10 overflow-hidden">
              <div class="h-full rounded-full bg-gradient-to-r from-amber-400/70 to-rose-400/70" style="width:50%" data-role="balanceFBFill"></div>
            </div>
          </div>
        </div>

        <div class="rounded-2xl border border-white/10 bg-white/5 p-4 grid grid-cols-2 gap-3 text-sm">
          <div class="space-y-1">
            <div class="text-slate-400 text-xs">Rata Tekanan</div>
            <div class="font-semibold" data-role="avgPressure">—</div>
          </div>
          <div class="space-y-1">
            <div class="text-slate-400 text-xs">Durasi Sesi</div>
            <div class="font-semibold" data-role="duration">—</div>
          </div>
          <div class="space-y-1">
            <div class="text-slate-400 text-xs">Peringatan</div>
            <div class="font-semibold" data-role="alerts">0</div>
          </div>
          <div class="space-y-1">
            <div class="text-slate-400 text-xs">Resolusi</div>
            <div class="font-semibold" data-role="resolution">8×8</div>
          </div>
        </div>

        <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
          <div class="text-slate-400 text-xs mb-1">Catatan</div>
          <div class="text-sm leading-relaxed" data-role="notes">—</div>
        </div>

        <div class="text-xs text-slate-400">ID: <span class="text-slate-200" data-role="id">seat-1</span> • Update: <span class="text-slate-200" data-role="updated">—</span></div>
      </section>

      <!-- Right: heatmap preview -->
      <section class="lg:col-span-7 rounded-2xl border border-white/10 bg-white/5 p-3">
        <div class="flex items-center justify-between px-1">
          <div class="text-sm font-medium">Heatmap Snapshot</div>
          <div class="flex items-center gap-2 text-xs">
            <button class="btn btn-outline btn-xs" data-action="exportPNG"><i data-lucide="image" class="h-3.5 w-3.5"></i> PNG</button>
            <button class="btn btn-outline btn-xs" data-action="exportJSON"><i data-lucide="file-down" class="h-3.5 w-3.5"></i> JSON</button>
            <button class="btn btn-outline btn-xs" data-action="calibrate"><i data-lucide="compass" class="h-3.5 w-3.5"></i> Kalibrasi</button>
          </div>
        </div>
        <div class="mt-2 relative aspect-[4/3] rounded-xl overflow-hidden border border-white/10 bg-[#0b1220]">
          <canvas id="heatmapPreview" class="absolute inset-0 w-full h-full"></canvas>
          <img id="silhouettePreview" alt="silhouette" src="./assets/img/silhouette-white.svg" class="absolute inset-0 w-full h-full opacity-40 pointer-events-none select-none" />
        </div>
      </section>
    </div>

    <!-- Footer -->
    <div class="px-5 py-3 border-t border-white/10 flex items-center justify-between bg-[#0b1220]/60">
      <div class="text-xs text-slate-400">Gunakan tombol PNG/JSON untuk menyimpan snapshot; Kalibrasi akan menjadikan matriks saat ini sebagai baseline.</div>
      <form method="dialog">
        <button class="btn btn-primary" data-action="close">Tutup</button>
      </form>
    </div>
  </div>
</dialog>

<style>
  /* Warna badge status mengikuti pola card-status */
  #sensorDetailModal .status-badge{ border-color: rgba(16,185,129,.35); color:#10b981; background: rgba(16,185,129,.10); }
  #sensorDetailModal .status-dot{ background:#10b981; }
  #sensorDetailModal[data-status="warn"] .status-badge{ border-color: rgba(245,158,11,.35); color:#f59e0b; background: rgba(245,158,11,.10); }
  #sensorDetailModal[data-status="warn"] .status-dot{ background:#f59e0b; }
  #sensorDetailModal[data-status="bad"] .status-badge{ border-color: rgba(239,68,68,.35); color:#ef4444; background: rgba(239,68,68,.10); }
  #sensorDetailModal[data-status="bad"] .status-dot{ background:#ef4444; }
  #sensorDetailModal[data-status="offline"] .status-badge{ border-color: rgba(148,163,184,.35); color:#94a3b8; background: rgba(148,163,184,.10); }
  #sensorDetailModal[data-status="offline"] .status-dot{ background:#94a3b8; }
</style>
